<html>
  <head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <style>
      ul {
        list-style-type: none;
        margin: 0;
        padding: 0;
        overflow: hidden;
      }

      li {
        float: right;
      }

      li a {
        display: block;
        color: white;
        text-align: center;
        padding: 14px 16px;
        text-decoration: none;
      }

      li a:hover:not(.active) {
        background-color: #111;
      }

      table {
        margin: 10;
        width: 99% !important;
        font-size: 16px;
      }

      #t01 th {
        border: 1px solid white;
        color: white;
      }

      #t02 th {
        border: 1px solid white;
        background-color: #D7DEFF;
        color: white;
        color: black;
      }

      th, td {
        padding: 5px;
        text-align: left;
        font-weight: normal;
        width: 13%;
      }

      #tbutton th {
        background-color: #FFFFFF;
      }

      label {
        display: table-cell;
      }

      input {
        display: table-cell;
        height: 50%;
        margin: 10;
        line-height: 1em;
        width: 15em;
      }

      .hidden {
        display: none;
      }

    </style>
    <title>HotZone case page</title>
    <ul class="bg-primary">
      <li><a href="not_yet_implemented">Logout</a></li>
      <li><a href="not_yet_implemented">Profile</a></li>
      <li><a href="not_yet_implemented">Add Data</a></li>
      <li><a href="/cases/">View / Edit data</a></li>
      <li style="float:left"><a href="not_yet_implemented">HotZone</a></li>
    </ul>
  </head>
  <body>

    <form style='display: table;
    margin:10; line-height: 3;'>
      <p style='display:table-row'>
        <label for="cid">Case ID</label>
        <input type="text" id="cid" name="cid" value="{{filtercase.0.case.case_id}}">
      </p>
      <p style='display:table-row'>
        <label for="cdate">Date Confirmed</label>
        <input type="date" id="cdate" name="cdate" value="{{filtercase.0.case.date|date:'Y-m-d'}}">
      </p>
      <p style='display:table-row'>
        <label for="loi">Local/Imported</label>
        <input type="text" id="loi" name="loi" value="{{filtercase.0.case.get_category_display|title}}">
      </p>
      <p style='display:table-row'>
        <label for="pname">Patient Name</label>
        <input type="text" id="pname" name="pname" value="{{filtercase.0.case.patient.firstname}} {{filtercase.0.case.patient.lastname}}">
      </p>
      <p style='display:table-row'>
        <label for="idn">Identity Document Number</label>
        <input type="text" id="idn" name="idn" value="{{filtercase.0.case.patient.idn}}">
      </p>
      <p style='display:table-row'>
        <label for="dob">Date of Birth</label>
        <input type="date" id="dob" name="dob" value="{{filtercase.0.case.patient.dob|date:'Y-m-d'}}">
      </p>
      <p style='display:table-row'>
        <label for="vname">Virus Name</label>
        <input type="text" id="vname" name="vname" value="{{filtercase.0.case.virus.name}}">
      </p>
      <p style='display:table-row'>
        <label for="disease">Disease</label>
        <input type="text" id="disease" name="disease" value="{{filtercase.0.case.virus.common_name}}">
      </p>
      <p style='display:table-row'>
        <label for="mip">Max Infected Period</label>
        <input type="text" id="mip" name="mip" value="{{filtercase.0.case.virus.period}}">
      </p>
    </form>

    <form action='{{filtercase.0.case.case_id}}/add_visit' method='GET' style='margin:10'>
      Visit(s)
      <button type='submit' class="btn btn-primary"> Add Visit</button>
    </form>

    <table id="t01">
      <tr>
        <th class="bg-primary">Location</th>
        <th class="bg-primary">Address</th>
        <th class="bg-primary">X Coord</th>
        <th class="bg-primary">Y Coord</th>
        <th class="bg-primary">Date From</th>
        <th class="bg-primary">Date To</th>
        <th class="bg-primary">Category</th>
        <th style='background-color: #FFFFFF'></th>
      </tr>
    </table>

    <table id="t02">
      {% for loc in filtercase %}
      <tr>
        <th>{{loc.location.name}}</th>
        <th>{{loc.location.address}}</th>
        <th>{{loc.location.x}}</th>
        <th>{{loc.location.y}}</th>
        <th>{{loc.date_from}}</th>
        <th>{{loc.date_to}}</th>
        <th>{{loc.get_category_display|title}}</th>
        <th id="tbutton" style='background-color: #FFFFFF;
        vertical-align: middle;
        text-align: center;'>
          <form style='margin: auto;
          display: inline-block;'>
            <button type='button' value='Remove' onclick="remove(this)"  class="btn btn-primary">Remove</button>
          </form>
        </th>
      </tr>
      {% endfor %}

      <tr>
        <th style='background-color: #FFFFFF'></th>
        <th style='background-color: #FFFFFF'></th>
        <th style='background-color: #FFFFFF'></th>
        <th style='background-color: #FFFFFF'></th>
        <th style='background-color: #FFFFFF'></th>
        <th style='background-color: #FFFFFF'></th>
        <th style='background-color: #FFFFFF'></th>
        <th id="tbutton" style='background-color: #FFFFFF;
        vertical-align: middle;
        text-align: center;'>
          <form name="saveform" action="save" style='margin: auto;
          display: inline-block;'>
            <input id="oldcaseid" type="hidden" name="oldcaseid"/>
            <input id="caseid" type="hidden" name="caseid"/>
            <input id="confirmeddate" type="hidden" name="confirmeddate"/>
            <input id="localimported" type="hidden" name="localimported"/>
            <input id="patientname" type="hidden" name="patientname"/>
            <input id="IDN" type="hidden" name="IDN"/>
            <input id="DoB" type="hidden" name="DoB"/>
            <input id="virusname" type="hidden" name="virusname"/>
            <input id="commonname" type="hidden" name="commonname"/>
            <input id="MIP" type="hidden" name="MIP"/>
            <input id="locations" type="hidden" name="locations"/>
            <input id="addresses" type="hidden" name="addresses"/>
            <input id="xs" type="hidden" name="xs"/>
            <input id="ys" type="hidden" name="ys"/>
            <input id="dfroms" type="hidden" name="dfroms"/>
            <input id="dtos" type="hidden" name="dtos"/>
            <input id="categories" type="hidden" name="categories"/>
            <a href="javascript: save()" class="btn btn-primary">Save</a>
          </form>
        </th>
      </tr>
    </table>

    <script>

      function remove(r) {
        var i = r.parentNode.parentNode.parentNode.rowIndex;
        document.getElementById("t02").deleteRow(i);
      }
    </script>

    <script type="text/javascript">

      function save() {
        var row_number=document.getElementById("t02").rows.length-1;
        var caseid=document.getElementById("cid").value;
        var confirmeddate=document.getElementById("cdate").value;
        var localimported=document.getElementById("loi").value;
        var patientname=document.getElementById("pname").value;
        var idn=document.getElementById("idn").value;
        var dob=document.getElementById("dob").value;
        var virusname=document.getElementById("vname").value;
        var disease=document.getElementById("disease").value;
        var mip=document.getElementById("mip").value;
        var url=window.location.href;
        var pos=url.search('cases/')+6;
        var oldid=url.substring(pos,);
        document.getElementById("oldcaseid").value=oldid;
        document.getElementById("caseid").value=caseid;
        document.getElementById("confirmeddate").value=confirmeddate;
        document.getElementById("localimported").value=localimported;
        document.getElementById("patientname").value=patientname;
        document.getElementById("IDN").value=idn;
        document.getElementById("DoB").value=dob;
        document.getElementById("virusname").value=virusname;
        document.getElementById("commonname").value=disease;
        document.getElementById("MIP").value=mip;

        var table=document.getElementById("t02");
        var i;
        var empty="";
        var alocations=[];
        var aaddresses=[];
        var axs=[];
        var ays=[];
        var adfroms=[];
        var adtos=[];
        var acategories=[];

        for (i=0; i<row_number; i++){
          if (table.rows[i].cells[0].innerHTML==""){
            alocations.push(empty);
          }
          else {
            alocations.push(table.rows[i].cells[0].innerHTML);
          }

          if (table.rows[i].cells[1].innerHTML==""){
            aaddresses.push(empty);
          }
          else {
            aaddresses.push(table.rows[i].cells[1].innerHTML);
          }

          if (table.rows[i].cells[2].innerHTML==""){
            axs.push(empty);
          }
          else {
            axs.push(table.rows[i].cells[2].innerHTML);
          }

          if (table.rows[i].cells[3].innerHTML==""){
            ays.push(empty);
          }
          else {
            ays.push(table.rows[i].cells[3].innerHTML);
          }

          if (table.rows[i].cells[4].innerHTML==""){
            adfroms.push(empty);
          }
          else {
            var date=new Date(table.rows[i].cells[4].innerHTML);
            date.setHours(8);
            var isodate=date.toISOString();
            adfroms.push(isodate);
          }

          if (table.rows[i].cells[5].innerHTML==""){
            atos.push(empty);
          }
          else {
            var date=new Date(table.rows[i].cells[5].innerHTML);
            date.setHours(8);
            var isodate=date.toISOString();
            adtos.push(isodate);
          }

          if (table.rows[i].cells[6].innerHTML==""){
            acategories.push(empty);
          }
          else {
            acategories.push(table.rows[i].cells[6].innerHTML);
          }
        }
        document.getElementById("locations").value=alocations;
        document.getElementById("addresses").value=aaddresses;
        document.getElementById("xs").value=axs;
        document.getElementById("ys").value=ays;
        document.getElementById("dfroms").value=adfroms;
        document.getElementById("dtos").value=adtos;
        document.getElementById("categories").value=acategories;

        document.forms['saveform'].submit();
      }
    </script>

  </body>
</html>
